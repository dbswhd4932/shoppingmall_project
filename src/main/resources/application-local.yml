spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3307/shoppingmall?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: shopuser
    password: shop1234
  main:
    allow-bean-definition-overriding: true
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        format_sql: true
        show_sql: true
        default_batch_fetch_size: 100
    database: mysql
    open-in-view: false
  mvc:
    path match:
      matching-strategy: ant_path_matcher
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
  cache:
    jcache:
      config: classpath:ehcache.xml

  # Redis 설정
  redis:
    host: localhost
    port: 6379
    timeout: 3000ms  # 연결 타임아웃 3초
    lettuce:
      pool:
        max-active: 8   # 최대 커넥션 수
        max-idle: 8     # 최대 유휴 커넥션 수
        min-idle: 2     # 최소 유휴 커넥션 수
        max-wait: -1ms  # 커넥션 대기 시간 (-1: 무제한)

  # RabbitMQ 설정
  rabbitmq:
    host: localhost
    port: 5672
    username: admin
    password: admin1234
    listener:
      simple:
        acknowledge-mode: auto  # 자동 ACK
        concurrency: 5          # 동시 처리할 Consumer 수
        max-concurrency: 10     # 최대 Consumer 수
        prefetch: 10            # 한 번에 가져올 메시지 수
    publisher-confirm-type: correlated # producer가 메시지 보냈을 때, Rabbit이 메시지를 잘 받았는지 확인(ACK/NACK) 받겠다는 옵션
    publisher-returns: true # 주소(Routing Key)가 잘못되었거나 해당 주소와 연결된 큐가 없어서 배달에 실패한 경우 > Return

logging:
  level:
    org:
      hibernate:
        type:
          descriptor:
            sql: debug
    root: info

# AWS 설정 비활성화 (로컬 환경에서는 S3를 사용하지 않음)
cloud:
  aws:
    credentials:
      access-key: local-dummy-access-key
      secret-key: local-dummy-secret-key
    s3:
      bucket: local-dummy-bucket
    region:
      static: ap-northeast-2
    stack:
      auto: false

jwt:
  header: Authorization

# 로컬 파일 업로드 설정
file:
  upload:
    directory: uploads

# Slack 알림 설정
slack:
  webhook:
    url: ${SLACK_WEBHOOK_URL}  # .env 파일의 환경변수 사용
    enabled: true  # Slack 알림 활성화 여부

# Prometheus + Grafana 모니터링 설정
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics  # 노출할 엔드포인트
      base-path: /actuator
  endpoint:
    health:
      show-details: always  # 헬스 체크 상세 정보 표시
    prometheus:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name:shoppingmall}  # 애플리케이션 태그
      environment: local
    distribution:
      percentiles-histogram:
        http.server.requests: true  # HTTP 요청 히스토그램 활성화
  server:
    port: 8080  # Actuator도 동일 포트 사용
